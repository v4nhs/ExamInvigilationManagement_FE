<div class="reports-container">
  <div class="reports-content">
    <!-- Page Header -->
    <div class="reports-header">
      <h1>B√°o C√°o Thanh To√°n</h1>
      <p>Chi ti·∫øt b√°o c√°o thanh to√°n cho gi·∫£ng vi√™n coi thi</p>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-spinner">
      <div class="spinner"></div>
      <p>ƒêang t·∫£i d·ªØ li·ªáu...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="error-message">
      {{ error }}
    </div>

    <!-- Main Content -->
    <div *ngIf="!loading && !error">
      <!-- Statistics Summary -->
      <div class="summary-grid">
        <div class="summary-card">
          <div class="summary-label">T·ªïng Doanh Thu</div>
          <div class="summary-value">{{ formatCurrency(totalRevenue) }}</div>
        </div>
        <div class="summary-card">
          <div class="summary-label">Trung B√¨nh Thanh To√°n</div>
          <div class="summary-value">{{ formatCurrency(averagePayment) }}</div>
        </div>
        <div class="summary-card">
          <div class="summary-label">Thanh To√°n Cao Nh·∫•t</div>
          <div class="summary-value">{{ formatCurrency(maxPayment) }}</div>
        </div>
        <div class="summary-card">
          <div class="summary-label">Thanh To√°n Th·∫•p Nh·∫•t</div>
          <div class="summary-value">{{ formatCurrency(minPayment) }}</div>
        </div>
        <div class="summary-card">
          <div class="summary-label">T·ªïng L·∫ßn Thanh To√°n</div>
          <div class="summary-value">{{ allPayments.length }}</div>
        </div>
        <div class="summary-card">
          <div class="summary-label">Gi·∫£ng Vi√™n Nh·∫≠n Thanh To√°n</div>
          <div class="summary-value">{{ topLecturers.length }}</div>
        </div>
      </div>

      <!-- Top Lecturers Section -->
      <div class="report-section">
        <div class="section-header">
          <h2>üèÜ Top 10 Gi·∫£ng Vi√™n Nh·∫≠n Thanh To√°n Cao Nh·∫•t</h2>
        </div>
        <div class="top-lecturers-list">
          <div *ngFor="let lecturer of topLecturers; let i = index" class="lecturer-item">
            <div class="rank-badge">{{ i + 1 }}</div>
            <div class="lecturer-info">
              <div class="lecturer-name">{{ lecturer.name }}</div>
              <div class="lecturer-meta">{{ lecturer.count }} l·∫ßn thanh to√°n</div>
            </div>
            <div class="lecturer-amount">{{ formatCurrency(lecturer.amount) }}</div>
          </div>
        </div>
      </div>

      <!-- Detailed Report Section -->
      <div class="report-section">
        <div class="section-header">
          <h2>üìã B√°o C√°o Chi Ti·∫øt</h2>
          <div class="section-actions">
            <button class="export-btn" (click)="exportToCSV()">
              üì• Xu·∫•t CSV
            </button>
          </div>
        </div>

        <!-- Filters -->
        <div class="filters-bar">
          <div class="filter-group">
            <input
              type="text"
              class="search-input"
              placeholder="T√¨m ki·∫øm gi·∫£ng vi√™n..."
              [(ngModel)]="searchQuery"
              (input)="onSearchChange()"
            />
          </div>
          <div class="filter-group">
            <select class="status-select" [(ngModel)]="statusFilter" (change)="onStatusFilterChange()">
              <option value="ALL">T·∫•t c·∫£ tr·∫°ng th√°i</option>
              <option value="PAID">ƒê√£ thanh to√°n</option>
              <option value="PENDING">Ch·ªù thanh to√°n</option>
              <option value="CANCELLED">ƒê√£ h·ªßy</option>
              <option value="CH∆ØA_THANH_TO√ÅN">Ch∆∞a thanh to√°n</option>
            </select>
          </div>
          <button class="clear-btn" (click)="clearFilters()">üîÑ X√≥a B·ªô L·ªçc</button>
        </div>

        <!-- Results Info -->
        <div class="results-info">
          Hi·ªÉn th·ªã {{ filteredPayments.length }} / {{ allPayments.length }} b·∫£n ghi
        </div>

        <!-- Detailed Table -->
        <div class="table-wrapper">
          <table class="report-table">
            <thead>
              <tr>
                <th>M√£ Kho·∫£n</th>
                <th (click)="changeSortBy('lecturer')" class="sortable">
                  Gi·∫£ng Vi√™n
                  <span class="sort-icon" *ngIf="sortBy === 'lecturer'">
                    {{ sortDirection === 'DESC' ? '‚ñº' : '‚ñ≤' }}
                  </span>
                </th>
                <th (click)="changeSortBy('amount')" class="sortable amount-col">
                  S·ªë Ti·ªÅn
                  <span class="sort-icon" *ngIf="sortBy === 'amount'">
                    {{ sortDirection === 'DESC' ? '‚ñº' : '‚ñ≤' }}
                  </span>
                </th>
                <th (click)="changeSortBy('status')" class="sortable">
                  Tr·∫°ng Th√°i
                  <span class="sort-icon" *ngIf="sortBy === 'status'">
                    {{ sortDirection === 'DESC' ? '‚ñº' : '‚ñ≤' }}
                  </span>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let payment of filteredPayments">
                <td class="id-col">{{ payment.id }}</td>
                <td>{{ extractLecturerName(payment) }}</td>
                <td class="amount-col">{{ formatCurrency(payment.totalAmount || 0) }}</td>
                <td>
                  <span
                    class="status-badge"
                    [style.backgroundColor]="getStatusColor(payment.status || 'CH∆ØA_THANH_TO√ÅN')"
                  >
                    {{ getStatusLabel(payment.status || 'CH∆ØA_THANH_TO√ÅN') }}
                  </span>
                </td>
              </tr>
              <tr *ngIf="filteredPayments.length === 0" class="no-data">
                <td colspan="4">Kh√¥ng c√≥ d·ªØ li·ªáu ph√π h·ª£p</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
