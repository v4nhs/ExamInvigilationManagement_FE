<div class="course-list-container">
  <div class="page-header">
    <h2>Danh s√°ch h·ªçc ph·∫ßn</h2>
    <div class="header-actions">
      <button class="add-btn" (click)="openAddForm()">+ Th√™m h·ªçc ph·∫ßn</button>
      <button class="import-btn" (click)="fileInput.click()">‚¨Ü Import t·ª´ file</button>
      <input type="file" #fileInput hidden accept=".xlsx,.xls" (change)="onFileSelected($event)" />
    </div>
  </div>

  <div class="search-filter-section">
    <div class="search-box">
      <i class="search-icon">üîç</i>
      <input 
        type="text" 
        placeholder="T√¨m ki·∫øm theo t√™n h·ªçc ph·∫ßn, m√£ h·ªçc ph·∫ßn..."
        [(ngModel)]="searchQuery"
        (input)="onSearchChange()"
        class="search-input"
      />
      <button *ngIf="searchQuery" class="clear-btn" (click)="clearSearch()">‚úï</button>
    </div>
  </div>

  <table *ngIf="filteredCourses.length > 0; else emptyBlock">
    <thead>
      <tr>
        <th>#</th>
        <th>M√£ h·ªçc ph·∫ßn</th>
        <th>T√™n h·ªçc ph·∫ßn</th>
        <th>S·ªë t√≠n ch·ªâ</th>
        <th>Khoa</th>
        <th>M√¥ t·∫£</th>
        <th>H√†nh ƒë·ªông</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let course of filteredCourses; let i = index">
        <td>{{ currentPage * pageSize + i + 1 }}</td>
        <td><span class="course-code">{{ course.code }}</span></td>
        <td>{{ course.name }}</td>
        <td><span class="credits-badge">{{ course.credits }} TC</span></td>
        <td>{{ course.departmentName || 'N/A' }}</td>
        <td>{{ course.description || '-' }}</td>
        <td>
          <button class="edit-btn" (click)="openAddForm(course.id)">S·ª≠a</button>
          <button class="delete-btn" (click)="deleteCourse(course.id)" [disabled]="deleting === course.id">
            {{ deleting === course.id ? 'ƒêang x√≥a...' : 'X√≥a' }}
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <ng-template #emptyBlock>
    <div class="empty">Kh√¥ng c√≥ h·ªçc ph·∫ßn n√†o.</div>
  </ng-template>

  <div *ngIf="loading" class="loading">ƒêang t·∫£i...</div>

  <!-- Pagination Controls -->
  <div class="pagination-container" *ngIf="totalPages > 1 || totalElements > 0">
    <div class="pagination-header">
      <div class="pagination-info">
        Hi·ªÉn th·ªã {{ currentPage * pageSize + 1 }} ƒë·∫øn {{ Math.min((currentPage + 1) * pageSize, totalElements) }} 
        tr√™n t·ªïng s·ªë {{ totalElements }} h·ªçc ph·∫ßn
      </div>
      
      <div class="page-size-selector">
        <label for="pageSize">Hi·ªÉn th·ªã:</label>
        <select 
          id="pageSize"
          [(ngModel)]="pageSize" 
          (change)="onPageSizeChange()"
          class="page-size-select">
          <option *ngFor="let size of pageSizeOptions" [value]="size">
            {{ size }} m·ª•c
          </option>
        </select>
      </div>
    </div>
    
    <div class="pagination-controls" *ngIf="totalPages > 1">
      <button 
        class="page-btn" 
        (click)="previousPage()" 
        [disabled]="currentPage === 0">
        ‚Üê Tr∆∞·ªõc
      </button>

      <button 
        *ngFor="let page of getPageNumbers()"
        class="page-btn"
        [class.active]="page === currentPage"
        (click)="goToPage(page)">
        {{ page + 1 }}
      </button>

      <button 
        class="page-btn" 
        (click)="nextPage()" 
        [disabled]="currentPage === totalPages - 1">
        Ti·∫øp ‚Üí 
      </button>
    </div>
  </div>

  <!-- Import Dialog -->
  <div *ngIf="showImportDialog" class="import-dialog-overlay">
    <div class="import-dialog">
      <div class="dialog-header">
        <h3>Nh·∫≠p h·ªçc ph·∫ßn t·ª´ file</h3>
      </div>
      <div class="dialog-body">
        <div class="form-group">
          <label>Ch·ªçn khoa</label>
          <select [(ngModel)]="selectedDepartmentId" class="department-select">
            <option value="0" disabled>-- Ch·ªçn khoa --</option>
            <option *ngFor="let dept of departments" [value]="dept.id">
              {{ dept.name }}
            </option>
          </select>
        </div>
        <div class="file-info">
          <p><strong>File:</strong> {{ importFile?.name }}</p>
        </div>
      </div>
      <div class="dialog-footer">
        <button class="cancel-btn" (click)="closeImportDialog()" [disabled]="importing">H·ªßy</button>
        <button class="confirm-btn" (click)="confirmImport()" [disabled]="importing">
          {{ importing ? 'ƒêang import...' : 'Import' }}
        </button>
      </div>
    </div>
  </div>

  <app-course-add 
    *ngIf="showAddForm" 
    [editCourseId]="editingCourseId"
    (close)="closeAddForm()" 
    (saved)="onCourseSaved()">
  </app-course-add>
</div>

