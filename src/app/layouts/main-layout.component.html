<nz-layout class="app-layout">
  <!-- Header with Logo and School Name at Top, Menu Navigation in same row -->
  <header class="hau-top-header">
    <button class="menu-toggle-btn" (click)="toggleSidebar()" *ngIf="isMobile">
      <span class="hamburger"></span>
      <span class="hamburger"></span>
      <span class="hamburger"></span>
    </button>
    <div class="hau-logo-section">
      <img
        src="https://upload.wikimedia.org/wikipedia/commons/0/03/Logo_HAU.png"
        alt="Logo" class="hau-logo-image" />
      <div class="hau-title-section">
        <div class="hau-name">ĐẠI HỌC KIẾN TRÚC HÀ NỘI</div>
        <div class="hau-slogan">HANOI ARCHITECTURAL UNIVERSITY</div>
      </div>
    </div>
    <div class="hau-header-right">
      <nav class="hau-nav">
        <a routerLink="/" routerLinkActive="active">Trang chủ</a>
        <span>|</span>
        <a href="#">Lịch tuần</a>
        <span>|</span>
        <a href="#">E-mail</a>
        <span>|</span>
        <a href="#">Liên hệ</a>
        <span>|</span>
        <a href="#">Sơ đồ trang</a>
      </nav>
      <div class="hau-account" *ngIf="currentUser; else loginBlock">
        <ul class="account-menu">
          <li class="account-name" (click)="showDropdown = !showDropdown">
            {{ currentUser.username }}
            <span style="font-size: 10px; margin-left: 4px;">▼</span>
            <ul class="account-dropdown" *ngIf="showDropdown">
              <li class="account-role">Vai trò: {{ getRoleDescription(currentUser.role) }}</li>
              <li class="divider"></li>
              <li class="account-change-password" (click)="openChangePasswordModal()">
                <i nz-icon nzType="lock" nzTheme="outline"></i>
                Đổi mật khẩu
              </li>
              <li class="divider"></li>
              <li class="account-logout" (click)="logout()">
                Đăng xuất
              </li>
            </ul>
          </li>
        </ul>
      </div>
      <ng-template #loginBlock>
        <div class="hau-account">
          <span>Tài khoản</span>
          <div class="hau-account-dropdown">
            <a routerLink="/login">Đăng nhập</a>
          </div>
        </div>
      </ng-template>
    </div>
  </header>

  <nz-sider class="menu-sidebar" [ngClass]="{ 'open': sidebarOpen }" nzCollapsible nzWidth="256px" nzBreakpoint="md" [(nzCollapsed)]="isCollapsed"
    [nzTrigger]="null">
    <ul nz-menu nzTheme="dark" nzMode="inline" [nzInlineCollapsed]="isCollapsed">
      <li nz-menu-item nzMatchRouter [nzMatchRouterExact]="true" routerLink="/dashboard" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" *ngIf="isAdmin() || isDepartment() || isAccounting()">
        <i nz-icon nzType="bar-chart" nzTheme="outline"></i>
        <span>Thống Kê</span>
      </li>

      <li nz-submenu nzOpen nzTitle="Lịch thi sinh viên" nzIcon="schedule">
        <ul>
          <li nz-menu-item nzMatchRouter [nzMatchRouterExact]="true" routerLink="/exam-schedules" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
            Lịch thi
          </li>
          <li *ngIf="isLecturer()" nz-menu-item nzMatchRouter [nzMatchRouterExact]="true" routerLink="/my-exam-assignments" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
            Lịch thi của tôi
          </li>
        </ul>
      </li>

      <li *ngIf="isAdmin() || isDepartment()" nz-submenu nzOpen nzTitle="Phân công coi thi" nzIcon="form">
        <ul>
          <li nz-menu-item nzMatchRouter [nzMatchRouterExact]="true" routerLink="/exam-assignment" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
            Phân công
          </li>
        </ul>
      </li>

      <li *ngIf="isAdmin() || isDepartment()" nz-submenu nzOpen nzTitle="Quản lý khoa" nzIcon="apartment">
        <ul>
          <li nz-menu-item nzMatchRouter [nzMatchRouterExact]="true" routerLink="/department-management" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
            Danh sách khoa
          </li>
          <li nz-menu-item nzMatchRouter [nzMatchRouterExact]="true" routerLink="/lecturers" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
            Danh sách cán bộ
          </li>
          <li nz-menu-item nzMatchRouter [nzMatchRouterExact]="true" routerLink="/courses" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
            Danh sách học phần
          </li>
        </ul>
      </li>

      <li *ngIf="isAdmin() || isAccounting() || isDepartment() || isLecturer()" nz-submenu nzOpen nzTitle="Đối soát" nzIcon="bar-chart">
        <ul>
          <li nz-menu-item nzMatchRouter [nzMatchRouterExact]="true" routerLink="/payment" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" (click)="onPaymentMenuClick('payment')">
            Danh sách thanh toán
          </li>
          <li *ngIf="isAdmin() || isAccounting() || isDepartment()" nz-menu-item nzMatchRouter (click)="onPaymentMenuClick('payouts')">
            <a routerLink="/payouts">Thống kê thanh toán</a>
          </li>
          <li nz-menu-item nzMatchRouter (click)="onPaymentMenuClick('reports')">
            <a routerLink="/reports">Báo cáo</a>
          </li>
        </ul>
      </li>

      <li *ngIf="isAdmin()" nz-submenu nzOpen nzTitle="Quản lý người dùng" nzIcon="user">
        <ul>
          <li nz-menu-item nzMatchRouter [nzMatchRouterExact]="true" routerLink="/user-management"
            routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
            Danh sách người dùng
          </li>
          <li nz-menu-item nzMatchRouter [nzMatchRouterExact]="true" routerLink="/user-management/roles">
            Quản lý vai trò
          </li>
        </ul>
      </li>

      <li nz-menu-item nzMatchRouter>
        <a routerLink="/settings">Thiết lập</a>
      </li>
    </ul>
  </nz-sider>
  <nz-layout>
    <nz-content>
      <div class="inner-content">
        <router-outlet></router-outlet>
      </div>
    </nz-content>
  </nz-layout>
</nz-layout>

<!-- Change Password Modal -->
<app-change-password *ngIf="showChangePasswordModal" (closeEvent)="closeChangePasswordModal()"></app-change-password>
